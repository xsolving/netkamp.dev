var NK_I18n=function(){var _nk=new NK,_super=new GB_I18n,_self=$.extend(!0,_nk,_super,{className:"NK_I18n",userLangStoreKey:"xcamp-user-lang"});return _self},NK_Widget=function(){var _super=new NK,_self=$.extend(!0,_super,{className:"NK_Widget",_getLangStringFromI18nItem:function(i18nItem){var i18n=new NK_I18n,lang=i18n.getUserDefLang(),retVal="Generic String in "+lang;return i18nItem.hasOwnProperty(lang)&&(retVal=i18nItem[lang]),retVal}});return _self},NK_Widget_Url=function(){var _super=new NK_Widget,_self=$.extend(!0,_super,{className:"NK_Widget_Url",getHash:function(){return window.location.hash.slice(1)},getPageNameFromHash:function(){var hash=_self.getHash(),items=hash.split(/\?/);return items[0]},getParamsFromHash:function(){var hash=_self.getHash(),items=hash.split(/\?/),vars={};if(items.length>1){hash.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){(matches=key.match(/(.*)\[(.*)\]/))?(vars.hasOwnProperty(matches[0])||(vars[matches[1]]={}),vars[matches[1]][matches[2]]=value):vars[key]=value})}return vars},getParamFromHash:function(paramName){var params=_self.getParamsFromHash();return params.hasOwnProperty(paramName)?params[paramName]:null},existsParamInHash:function(paramName){var params=_self.getParamsFromHash();return params.hasOwnProperty(paramName)},getUrlParam:function(name){var results=new RegExp("[?&]"+name+"=([^&#]*)").exec(window.location.href);return null==results?null:decodeURIComponent(results[1])||0},existsUrlParamValue:function(name){return!!_self.getUrlParam(name)},init:function(){$(window).bind("hashchange",function(){window.location.hash.slice(1)})}});return _self}(),NK_Widget_FormField=function(options){var _super=new NK_Widget,_self=$.extend(!0,_super,{className:"NK_Widget_FormField",id:"wff",randomId:"wff",config:{enabled:!0,visible:!0,form_id:"_myform",id:"_myfield",inputType:"text",size:{cols:"auto",rows:1},dataType:"text",emptyValue:"",isKeyField:!1,inputHelper:"",showClearButton:!0,autoSetData:!1,i18n:{label:{},errors:{fieldOptionsNotCorrectlySet:{it:"Le opzioni del campo non sono impostate correttamente",en:"Field options are not correctly set"}},groupUpperTitle:null},format:{firstFieldOfGroup:!1},validation:{methods:{}},typeahead:{},fieldsConnections:{parentFields:{},dependingFields:{}},db:{isToSave:!0},readOnly:{flag:!1}},structure:{selfRef:null,parentRef:null,inputFieldRef:null,formGroupRef:null,formGroupTitleRef:null,helpBlockRef:null,nk:{parentFormRef:null},imgThumbnailRef:null,dropzone:null},validation:{current:{state:null,i18nError:{it:"Errore",en:"Error"}}},status:{select:{fullLoaded:!1}},setParentFormRef:function(parentFormRef){_self.structure.nk.parentFormRef=parentFormRef},getParentFormRef:function(){return _self.structure.nk.parentFormRef},setConfigOptions:function(options){$.extend(!0,_self.config,options),_self.config.randomId=(Math.random().toString(36)+"00000000000000000").slice(2,8)},setId:function(newId){"undefined"!=typeof newId&&null!==newId&&newId.match(/^[a-zA-Z][a-zA-Z-_0-9]*/)&&(_self.config.id=newId)},getId:function(){return _self.config.id},setI18nLabel:function(obj){return"undefined"!=typeof obj&&null!==obj&&"object"==typeof obj?(_self.config.i18n.label=obj,_self.config.i18n.label):!1},_getI18nLabelString:function(){var i18n=new NK_I18n,lang=i18n.getUserDefLang();return _self.config.i18n.label.hasOwnProperty(lang)?_self.config.i18n.label[lang]:"XXXXXX"},setFormId:function(newId){"undefined"!=typeof newId&&null!==newId&&newId.match(/^[a-zA-Z][a-zA-Z-_0-9]*/)&&(_self.config.form_id=newId)},getFormId:function(){return _self.config.form_id},_getConnectedDOMFieldByDataFlatId:function(fieldId){_self.structure.nk.parentFormRef.getId();return $('#parentFormId input[data-flat-id="'+fieldId+'"]')},_setValue_InKeyField:function(value){var parentFormId=_self.structure.nk.parentFormRef.getId();$("#"+parentFormId+' input[ data-flat-id="'+_self.config.typeahead.keyField.name+'" ]').val(value)},_getRndFieldString:function(){return(Math.random().toString(36)+"00000000000000000").slice(2,8)},_getLabelId:function(){return _self.config.form_id+"-"+_self.config.id+"-label"},_getFieldId:function(){return _self.config.randomId},_getFlatFieldId:function(){return _self.config.id},_getBasicRequestParams:function(){var requestParams={co:"nop",ry:store.get("xcamp-ref-year"),id_sessione:store.get("xcamp-login_token")};return requestParams},appendTo:function(parentContainer){return 0===$(parentContainer).length?(GB_Debug.console.error("Parent non valido!"),!1):(_self.structure.parentRef=$(parentContainer),_self.structure.selfRef||_self.build(),null!==_self.structure.formGroupTitleRef&&$(_self.structure.formGroupTitleRef).appendTo(_self.structure.parentRef),$(_self.structure.selfRef).appendTo(_self.structure.parentRef),_self)},build:function(){if(!_self.structure.selfRef&&_self.config.enabled){_self.structure.selfRef=$("<div>"),null!==_self.config.i18n.groupUpperTitle&&(_self.structure.formGroupTitleRef=$("<div style='clear:both'><h4 class='fields-group-title'/></div>")),$(_self.structure.selfRef).css({"float":"left"});var formGroup=$("<div>").appendTo(_self.structure.selfRef);switch(_self.structure.formGroupRef=formGroup,$(formGroup).css("align","left"),_self.config.inputType){case"text":case"textarea":case"password":case"select":case"select2":case"typeahead":case"file":$(formGroup).addClass("form-group"),$(formGroup).addClass("has-feedback");break;case"checkbox":$(formGroup).addClass("form-group"),$(formGroup).addClass("has-feedback");break;case"hidden":}var inputGroup=null;switch(_self.config.inputType){case"text":case"textarea":case"password":case"select":case"select2":case"typeahead":case"file":var span=$("<label>").appendTo(formGroup);$(span).attr("id",_self._getLabelId()),$(span).attr("for",_self._getFieldId()),$(span).addClass("control-label"),$(span).css("white-space","nowrap");break;case"checkbox":var span=$("<label>").appendTo(formGroup);$(span).attr("id",_self._getLabelId()),$(span).attr("for",_self._getFieldId()),$(span).addClass("control-label"),$(span).css("white-space","nowrap");break;case"hidden":}inputGroup=$("<div>").appendTo(formGroup);var input=null;switch(_self.config.inputType){case"text":case"password":case"hidden":input=$("<input>").appendTo(inputGroup),$(input).attr("id",_self._getFieldId()),$(input).attr("name",_self._getFieldId()),$(input).attr("data-flat-id",_self._getFlatFieldId()),$(input).attr("type",_self.config.inputType),_self.config.hasOwnProperty("readOnly")&&_self.config.readOnly.hasOwnProperty("flag")&&_self.config.readOnly.flag!==!1&&_self.config.readOnly.flag&&$(input).attr("readOnly","true"),_self.structure.inputFieldRef=input,$(input).attr("autocomplete",_self._getFieldId()),$(input).addClass("form-control"),$(input).addClass("input-sm"),$(input).addClass("hasclear"),$(input).css("padding-right","25px");break;case"textarea":input=$("<textarea>").appendTo(inputGroup),$(input).attr("id",_self._getFieldId()),$(input).attr("name",_self._getFieldId()),$(input).attr("data-flat-id",_self._getFlatFieldId()),_self.structure.inputFieldRef=input,$(input).attr("autocomplete",_self._getFieldId()),$(input).addClass("form-control"),$(input).addClass("input-sm"),$(input).addClass("hasclear"),$(input).css("padding-right","25px"),$(input).css("resize","none"),_self.config.hasOwnProperty("size")&&_self.config.size.hasOwnProperty("rows")&&($(formGroup).css("height",36+30*_self.config.size.rows),$(input).attr("rows",_self.config.size.rows));break;case"select":case"select2":input=$("<select>").appendTo(inputGroup),_self.structure.inputFieldRef=input,$(input).addClass("form-control"),$(input).addClass("input-sm"),$(input).addClass("hasclear"),$(input).attr("data-style","btn-nk"),$(input).attr("id",_self._getFieldId()),$(input).attr("name",_self._getFieldId()),$(input).attr("data-flat-id",_self._getFlatFieldId()),$(input).css("padding-right","25px"),"gb-select"===_self.config.inputHelper&&_self.loadGbSelectList("build");break;case"checkbox":var chkDiv=$("<div>").appendTo(inputGroup);$(chkDiv).addClass("checkbox"),$(chkDiv).css("align","left"),$(chkDiv).css("width","100%");var chkLabel=$("<label>").appendTo(chkDiv);input=$("<input>").appendTo(chkLabel),$(input).attr("id",_self._getFieldId()),$(input).attr("name",_self._getFieldId()),$(input).attr("data-flat-id",_self._getFlatFieldId()),$(input).attr("type",_self.config.inputType),_self.structure.inputFieldRef=input,$(input).addClass("form-control"),$(input).addClass("input-sm"),$(input).on("click",function(e){e.stopPropagation()});break;case"file":input=$("<input>").appendTo(inputGroup),$(input).attr("id",_self._getFieldId()),$(input).attr("name",_self._getFieldId()),$(input).attr("data-flat-id",_self._getFlatFieldId()),$(input).attr("type","text"),$(input).attr("readonly","readonly"),_self.structure.inputFieldRef=input,$(input).attr("autocomplete",_self._getFieldId()),$(input).addClass("form-control"),$(input).addClass("input-sm"),$(input).addClass("hasclear"),$(input).css("padding-right","25px");var tmb=$("<img>").appendTo(inputGroup);$(tmb).attr("id",_self._getFieldId()+"_thumbnail"),$(tmb).addClass("img-thumbnail"),$(tmb).height(60),$(tmb).on("click",function(){NK_Widget_Modal_ImgPreview.showImage($(this).attr("data-image-path"))}),_self.structure.imgThumbnailRef=tmb;break;case"file2":var formGroup=$("<div>").appendTo(inputGroup);$(formGroup).css("bottom","23px"),$(formGroup).css("position","absolute"),$(formGroup).css("max-height","30px"),$(formGroup).addClass("form-group");var input=$("<button>----</button>").appendTo(formGroup);$(input).addClass("btn"),$(input).addClass("btn-default"),$(input).addClass("form-control"),$(input).addClass("input-sm"),$(input).addClass("form_submit_button"),$(input).attr("id",_self._getFieldId()+"_submit"),$(input).attr("data-flat-id",_self._getFlatFieldId()),$(input).on("click",_self.submitForm)}switch("hidden"!==_self.config.inputType&&(_self.config.hasOwnProperty("size")&&_self.config.size.hasOwnProperty("cols")&&"auto"!==_self.config.size.cols?($(_self.structure.selfRef).addClass("col-xs-"+2*(_self.config.size.cols+1)),$(_self.structure.selfRef).addClass("col-sm-"+(_self.config.size.cols+1))):"checkbox"===_self.config.inputType?($(_self.structure.selfRef).addClass("col-xs-2"),$(_self.structure.selfRef).addClass("col-sm-1")):($(_self.structure.selfRef).addClass("col-xs-4"),$(_self.structure.selfRef).addClass("col-sm-2")),"checkbox"===_self.config.inputType&&$(_self.structure.selfRef).css("width","auto"),"checkbox"!==_self.config.inputType&&($(formGroup).css("width","100%"),$(input).css("width","100%"))),_self.config.hasOwnProperty("eventHandlers")&&$.each(_self.config.eventHandlers,function(eventName,eventFn){"function"==typeof eventFn&&$(input).on(eventName,eventFn)}),_self.config.inputHelper){case"selectpicker":$(input).attr("data-live-search","true"),$(input).addClass("selectpicker"),$(input).selectpicker("refresh");break;case"gb-select":$(input).on("focus",function(){_self.loadGbSelectList("focus")});break;case"select2":$(input).select2({ajax:{url:"/json.php",dataType:"json",delay:250,data:function(params){var requestParams=_self.getRequestParams(params.term);return requestParams},processResults:function(data,params){params.page=params.page||1;var thisResults=[];return $.each(data.results.dataList.dataList.list,function(i,data){var item={id:data[_self.config.helperData.listData.keyField.name],text:data[_self.config.helperData.listData.textField.name]};thisResults.push(item)}),{results:thisResults,pagination:{more:30*params.page<data.results.dataList.dataList.count}}},cache:!0},escapeMarkup:function(markup){return markup},minimumInputLength:1});case"jquery-file-upload":$(input).on("click",function(){if(_self.structure.nk.parentFormRef.isCurrentEditingStatusModify()){var formKeyFields=_self.structure.nk.parentFormRef.getKeyFields();NK_Widget_Modal_Upload.clearAll(),NK_Widget_Modal_Upload.clearParamsToSend(),NK_Widget_Modal_Upload.addParamToSend("parent_type","form"),NK_Widget_Modal_Upload.addParamToSend("form_id",_self.structure.nk.parentFormRef.getId()),NK_Widget_Modal_Upload.addParamToSend("editing_object_name",_self.structure.nk.parentFormRef.getEditingObjectName()),NK_Widget_Modal_Upload.addParamToSend("keyfields_count",formKeyFields.length),NK_Widget_Modal_Upload.addParamToSend("upload_field_name",_self.getId()),$.each(formKeyFields,function(i,item){var keyField=_self.structure.nk.parentFormRef.getFieldRef(item);NK_Widget_Modal_Upload.addParamToSend("keyfield_"+i,item),NK_Widget_Modal_Upload.addParamToSend(item,keyField.getValue())}),NK_Widget_Modal_Upload.setCallBack("success",function(filePath){_self.setValue(filePath)}),NK_Widget_Modal_Upload.show()}else _self.structure.nk.parentFormRef.isCurrentEditingStatusNew()&&_self.config.i18n.hasOwnProperty("errors")&&_self.config.i18n.errors.hasOwnProperty("recordNotSaved")&&NK_Widget_Modal_Alert.show(_self.config.i18n.errors.recordNotSaved)});break;case"dropzone22":var myDropzone=(_self._getBasicRequestParams(),new Dropzone($(input),{url:"/json.php"}));myDropzone.on("addedfile",function(file){alert("done")});break;case"typeahead":if(_self.config.hasOwnProperty("readOnly")&&_self.config.readOnly.hasOwnProperty("flag")&&_self.config.readOnly.flag)break;$(input).attr("data-provide","typeahead");var getPermutations=function(str){function permutate(chars){0===chars.length&&permutations.push(nextWord.join(" "));for(var i=0;i<chars.length;i++)chars.push(chars.shift()),nextWord.push(chars[0]),permutate(chars.slice(1)),nextWord.pop()}var permutations=[],nextWord=[],chars=[];return"string"==typeof str?(str=str.replace(/^\s+/,""),str=str.replace(/\s+$/,""),chars=str.split(/\s+/)):"number"==typeof str?(str+="",chars=str.split("")):chars=str,permutate(chars),permutations};$(input).typeahead({minLength:2,display:"value",source:function(query,process){var requestParams=_self.getRequestParams(query),typeaheadFieldName=_self.getTypeaheadFieldName();return $.get("/json.php",requestParams,function(dataJson){var data=JSON.parse(dataJson.trim());if(_self.config.typeahead.objects=[],!!data.success==!0&&data.results)if(_self.config.typeahead.objects=[],_self.config.typeahead.map={},data.results.dataList.dataList.hasOwnProperty("list")){var res=data.results.dataList.dataList.list;$.each(res,function(i,object){var perms=getPermutations(object[typeaheadFieldName]);$.each(perms,function(cc,item){_self.config.typeahead.map[item]=object,_self.config.typeahead.objects.push(item)})})}else _self._setValue_InKeyField(_self.config.typeahead.keyField.emptyValue);return process(_self.config.typeahead.objects)})},matcher:function(item){var qq=this.query.replace(/\s+/,"\\s+"),rgxp=new RegExp("^"+qq,"ig");return!!item.match(rgxp)},updater:function(item){_self.structure.nk.parentFormRef.getRandomFormString();return _self.config.typeahead.keyField.hasOwnProperty("loadedListFieldName")?_self._setValue_InKeyField(_self.config.typeahead.map[item][_self.config.typeahead.keyField.loadedListFieldName]):_self._setValue_InKeyField(_self.config.typeahead.map[item][_self.config.typeahead.keyField.name]),item}}),$(input).change(function(){var current=$(input).typeahead("getActive");return _self.dependingFieldsReset(),current&&current==$(input).val()?($(input).data("row-values",JSON.stringify(current)),$(input).data("keyValue",current.id)):_self.config.typeahead.hasOwnProperty("freeItemsPermitted")&&_self.config.typeahead.freeItemsPermitted!==!1||_self.reset(),_self.validate(),!1})}switch(_self.config.inputType){case"text":case"textarea":case"password":case"checkbox":_self.config.dataType&&"date"===_self.config.dataType&&_self.config.inputHelper&&"bootstrap-datepicker"===_self.config.inputHelper?$(input).on("blur",function(){setTimeout(function(){_self.validate()},400)}):$(input).on("blur",function(){_self.validate()});break;case"select":case"select2":$(input).on("blur",function(){_self.validate()});break;case"file":}switch(_self.config.inputType){case"text":case"password":if(_self.config.dataType&&"date"===_self.config.dataType?("undefined"==typeof _self.structure&&(_self.structure={}),_self.structure.dateField=$(input).datepicker({autoclose:!0,language:"it",daysOfWeekHighlighted:[6],todayBtn:"linked",todayHighlight:!0,orientation:"bottom"}),"undefined"!=typeof _self.config.autoSetData&&_self.config.autoSetData!==!0||$(_self.structure.dateField).datepicker("update",new Date),$(_self.structure.dateField).datepicker().on("changeDate",function(){"function"==typeof _self.restartReloadTimeout&&_self.restartReloadTimeout()}),$(input).on("input",function(){"function"==typeof _self.restartReloadTimeout&&_self.restartReloadTimeout()})):$(input).on("input",function(){"function"==typeof _self.restartReloadTimeout&&_self.restartReloadTimeout()}),_self.config.showClearButton===!0){var clearButton=$("<span>").appendTo(inputGroup);$(clearButton).addClass("clearer glyphicon glyphicon-remove-circle input-clearer"),$(clearButton).css("margin-top","20px"),$(clearButton).css("margin-right","10px"),$(clearButton).css("cursor","hand"),$(clearButton).on("click",function(){var oldValue="",newValue="";_self.config.dataType&&"date"===_self.config.dataType?(oldValue=$(_self.structure.dateField).datepicker("getDate"),null!==oldValue&&$(_self.structure.dateField).datepicker("clearDates"),newValue=$(_self.structure.dateField).datepicker("getDate")):(oldValue=$(input).val(),$(input).val(""),newValue=$(input).val()),_self.reset(),null===newValue&&null===oldValue||newValue===oldValue||"function"==typeof _self.restartReloadTimeout&&_self.restartReloadTimeout(0)})}break;case"select":$(input).on("blur",function(){_self.validate()}),_self.config.hasOwnProperty("specs")&&_self.config.specs.hasOwnProperty("select")&&_self.config.specs.select.hasOwnProperty("type")&&"local"===_self.config.specs.select.type&&_self.config.specs.select.hasOwnProperty("values")&&_self.config.specs.select.values.hasOwnProperty("i18n")&&$.each(_self.config.specs.select.values.i18n,function(k,v){var optionString=_self._getLangStringFromI18nItem(v),newOption=$("<option>").appendTo(input);$(newOption).attr("value",k),$(newOption).html(optionString)});break;case"select2":break;case"radio":break;case"checkbox":break;case"textarea":case"file":if(_self.config.showClearButton===!0){var clearButton=$("<span>").appendTo(inputGroup);$(clearButton).addClass("clearer glyphicon glyphicon-remove-circle input-clearer"),$(clearButton).css("margin-top","20px"),"file"===_self.config.inputType?$(clearButton).css("margin-right","15px"):$(clearButton).css("margin-right","20px"),$(clearButton).width(10),$(clearButton).height(10),$(clearButton).on("click",function(){var oldValue="",newValue="";oldValue=$(input).val(),$(input).val(""),newValue=$(input).val(),_self.reset(),null===newValue&&null===oldValue||newValue===oldValue||"function"==typeof _self.restartReloadTimeout&&_self.restartReloadTimeout(0)})}}switch(_self.config.inputType){case"text":case"textarea":case"password":case"select":case"select2":case"typeahead":case"checkbox":case"file":_self.structure.helpBlockRef=$('<div class="help-block with-errors"></div>').appendTo(formGroup);case"hidden":}_self.translate()}return NK_I18n_Home.connectObject(_self.translate),_self},translate:function(){if($("#"+_self._getLabelId()).html(_self._getI18nLabelString()),_self.setValidationState(_self.validation.current.state,_self.validation.current.i18nError),null!==_self.config.i18n.groupUpperTitle){var fieldsGroupTitleLabel=_self._getLangStringFromI18nItem(_self.config.i18n.groupUpperTitle);$(_self.structure.formGroupTitleRef).find(".fields-group-title").html(fieldsGroupTitleLabel)}},getFieldSpecificOptions:function(specName){var retVal="";switch(specName){case"select_local_values":retVal=_self.config.hasOwnProperty("specs")&&_self.config.specs.hasOwnProperty("select")&&_self.config.specs.select.hasOwnProperty("type")&&"local"===_self.config.specs.select.type&&_self.config.specs.select.hasOwnProperty("values")&&_self.config.specs.select.values.hasOwnProperty("i18n")?_self.config.specs.select.values.i18n:{};break;case"select_type":retVal=_self.config.hasOwnProperty("specs")&&_self.config.specs.hasOwnProperty("select")&&_self.config.specs.select.hasOwnProperty("type")?_self.config.specs.select.type:"remote"}return retVal},setReadOnly:function(){$(_self.structure.inputFieldRef).attr("readOnly","true")},resetReadOnly:function(){$(_self.structure.inputFieldRef).removeAttr("readOnly")},setValue:function(value1,setInitValue){switch(null===value1&&(value1=_self.config.emptyValue),"undefined"==typeof setInitValue&&(setInitValue=!1),value=value1.toString(),value=value.trim(),_self.config.inputType){case"text":case"textarea":case"password":case"hidden":if($(_self.structure.inputFieldRef).val(value),"date"===_self.config.dataType){var dateValue=moment(value,"DD/MM/YYYY");dateValue.isValid()&&$(_self.structure.dateField).datepicker("update",dateValue.toDate())}break;case"file":if($(_self.structure.inputFieldRef).val(value),value){var valueItems=value.split("/");$(_self.structure.inputFieldRef).val(valueItems[valueItems.length-1]),$(_self.structure.inputFieldRef).attr("data-image-path",value),$(_self.structure.imgThumbnailRef).show(),valueItems[valueItems.length]=valueItems[valueItems.length-1],valueItems[valueItems.length-2]="thumbnail",thumbPath=valueItems.join("/");var fullTmbPath="uploaded_files/"+thumbPath,fullImagePath="uploaded_files/"+value;$(_self.structure.imgThumbnailRef).attr("src",fullTmbPath),$(_self.structure.imgThumbnailRef).attr("data-image-path",fullImagePath)}else $(_self.structure.inputFieldRef).val(""),$(_self.structure.inputFieldRef).attr("data-image-path",""),$(_self.structure.imgThumbnailRef).hide(),$(_self.structure.imgThumbnailRef).attr("src","assets/img/GB/no_image.jpg"),$(_self.structure.imgThumbnailRef).attr("data-image-path","");break;case"select":if("local"===_self.getFieldSpecificOptions("select_type")||_self.status.select.fullLoaded===!0)GB_Wallet.hasItem("NK_ff_setValue_"+_self.getId())&&(value=GB_Wallet.getItem("NK_ff_setValue_"+_self.getId()),console.log("Leggo da Wallet "+_self.getId()+"=>"+value),GB_Wallet.removeItem("NK_ff_setValue_"+_self.getId())),$(_self.structure.inputFieldRef).val(value),_self.resetReadOnly();else if(value!==_self.config.emptyValue&&""!==value)return console.log("Set timeout "+_self.getId()+"=>"+value),_self.setReadOnly(),GB_Wallet.hasItem("NK_ff_setValue_"+_self.getId())||GB_Wallet.setItem("NK_ff_setValue_"+_self.getId(),value),void setTimeout(function(){_self.setValue(value,!0)},100);break;case"radio":break;case"checkbox":$(_self.structure.inputFieldRef).prop("checked",parseInt(value))}setInitValue===!0&&$(_self.structure.inputFieldRef).attr("data-init-value",value),_self.validate()},isRemoteSelect:function(){return"select"===_self.config.inputType&&"local"!==_self.getFieldSpecificOptions("select_type")},getValue:function(format){var retVal=!1;switch("undefined"==typeof format&&(format={}),_self.config.inputType){case"text":case"textarea":case"password":case"hidden":if("date"===_self.config.dataType){var dateFormat="iso-8601";format.hasOwnProperty("date")&&(dateFormat=format.date);var fieldDate=$(_self.structure.dateField).datepicker("getDate");retVal=fieldDate&&_self.isValidDate(fieldDate)&&(value=_self.formatDate(fieldDate,dateFormat))!==!1?value.trim():""}else retVal=$(_self.structure.inputFieldRef).val(),retVal.trim()!==_self.config.emptyValue&&(retVal=retVal.trim());break;case"file":retVal=$(_self.structure.inputFieldRef).attr("data-image-path"),retVal.trim()!==_self.config.emptyValue&&(retVal=retVal.trim());break;case"select":retVal=$(_self.structure.inputFieldRef).val(),"undefined"!=typeof retVal&&null!==retVal||(retVal=_self.config.emptyValue);break;case"radio":break;case"checkbox":retVal=$(_self.structure.inputFieldRef).is(":checked")?1:0}return retVal},getEmptyValue:function(){return _self.config.emptyValue},reset:function(setInitValue){if("undefined"==typeof setInitValue&&(setInitValue=!1),_self.config.dataType&&"date"===_self.config.dataType&&$(_self.structure.inputFieldRef).datepicker("clearDates"),_self.setValue(_self.config.emptyValue,setInitValue),"typeahead"===_self.config.inputHelper){_self.structure.nk.parentFormRef.getRandomFormString();_self._setValue_InKeyField(_self.config.typeahead.keyField.emptyValue)}"select"===_self.config.inputType&&"local"!==_self.getFieldSpecificOptions("select_type")&&_self.config.helperData.ajax.loadOnFocus===!0&&(_self.status.select.fullLoaded=!1),_self.dependingFieldsReset(),_self.resetValidationState()},dependingFieldsReset:function(){$.each(_self.config.fieldsConnections.dependingFields,function(fieldName,fieldData){fieldData.hasOwnProperty("reset")&&fieldData.reset===!0&&(field=_self.structure.nk.parentFormRef.getFieldRef(fieldName))&&field.reset()})},_boolFunction:function(oldRetVal,joinConnector,rightValue){var tmpRetVal=oldRetVal;switch(joinConnector){case"and":tmpRetVal=tmpRetVal&&rightValue;break;case"or":tmpRetVal=tmpRetVal||rightValue;break;case"xor":}return tmpRetVal},recursiveValidation:function(validationTreeObj){var retVal="and"===validationTreeObj.join,fieldValue=_self.getValue();return $.each(validationTreeObj.list,function(i,options){switch(options.method){case"_children_":var match=_self.recursiveValidation(options);retVal=_self._boolFunction(retVal,validationTreeObj.join,match);break;case"function":if(console.log(options),"function"==typeof options.fn){var match=options.fn(_self);retVal=_self._boolFunction(retVal,validationTreeObj.join,match);var validationState=match?"success":"error";_self.setValidationState(validationState,options.error)}break;case"equalTo":var parentForm=_self.getParentFormRef(),fieldToCompare=parentForm.getFieldRef(options.fieldName),match=fieldToCompare.getValue()===_self.getValue();retVal=_self._boolFunction(retVal,validationTreeObj.join,match);var validationState=match?"success":"error";_self.setValidationState(validationState,options.error);break;case"greaterThan":var parentForm=_self.getParentFormRef(),fieldToCompare=parentForm.getFieldRef(options.fieldName),thisValue=_self.getValue({date:"yyyy-mm-dd"}).trim(),ftcValue=fieldToCompare.getValue({date:"yyyy-mm-dd"}).trim();if(""!==thisValue&&""!==ftcValue){var match=thisValue>ftcValue;retVal=_self._boolFunction(retVal,validationTreeObj.join,match);var validationState=match?"success":"error";_self.setValidationState(validationState,options.error)}break;case"lessThan":var parentForm=_self.getParentFormRef(),fieldToCompare=parentForm.getFieldRef(options.fieldName),thisValue=_self.getValue({date:"yyyy-mm-dd"}).trim(),ftcValue=fieldToCompare.getValue({date:"yyyy-mm-dd"}).trim();if(""!==thisValue&&""!==ftcValue){var match=ftcValue>thisValue;retVal=_self._boolFunction(retVal,validationTreeObj.join,match);var validationState=match?"success":"error";_self.setValidationState(validationState,options.error)}break;case"inBetween":var parentForm=_self.getParentFormRef(),minValue=0;if(options.hasOwnProperty("minorFieldName")){var minorFieldToCompare=parentForm.getFieldRef(options.minorFieldName);minValue=minorFieldToCompare.getValue({date:"yyyy-mm-dd"}).trim()}else{if(!options.hasOwnProperty("minValue")){var validationState="error";_self.setValidationState(validationState,_self.config.i18n.errors.fieldOptionsNotCorrectlySet);break}minValue=options.minValue}var maxValue=0;if(options.hasOwnProperty("minorFieldName")){var majorFieldToCompare=parentForm.getFieldRef(options.majorFieldName);maxValue=majorFieldToCompare.getValue({date:"yyyy-mm-dd"}).trim()}else{if(!options.hasOwnProperty("maxValue")){var validationState="error";_self.setValidationState(validationState,_self.config.i18n.errors.fieldOptionsNotCorrectlySet);break}maxValue=options.maxValue}var thisValue=_self.getValue({date:"yyyy-mm-dd"}).trim();if(""!==thisValue&&""!==minValue&&""!==maxValue){var match=thisValue>=minValue&&maxValue>=thisValue;retVal=_self._boolFunction(retVal,validationTreeObj.join,match);var validationState=match?"success":"error";_self.setValidationState(validationState,options.error)}break;case"regexp":var re=options.value,match=re.test(fieldValue);retVal=_self._boolFunction(retVal,validationTreeObj.join,match);var validationState=match?"success":"error";_self.setValidationState(validationState,options.error);break;case"verimail":var verimail=new Comfirm.AlphaMail.Verimail;verimail.verify(fieldValue,function(status,message,suggestion){if(0>status){retVal=!1;var validationState="error";suggestion?_self.setValidationState(validationState,options.suggestion,suggestion+"?"):_self.setValidationState(validationState,options.error)}else{retVal=!0;var validationState="success";suggestion?(validationState="warning",_self.setValidationState(validationState,options.suggestion,suggestion+"?")):_self.setValidationState(validationState,options.error)}})}return retVal||"and"!==validationTreeObj.join?retVal&&"or"===validationTreeObj.join?(_self.resetValidationState(),!1):void 0:!1}),retVal},validate:function(){var retVal=!0;_self.getValue();return _self.resetValidationState(),_self.config.hasOwnProperty("validation")&&_self.config.validation.hasOwnProperty("methods")&&(retVal=_self.recursiveValidation(_self.config.validation.methods)),_self.showValidationState(),retVal},validate_old:function(){var retVal=!0,fieldValue=_self.getValue();return _self.resetValidationState(),_self.config.hasOwnProperty("validation")&&_self.config.validation.hasOwnProperty("methods")&&$.each(_self.config.validation.methods,function(i,options){switch(options.method){case"functions":$.each(options,function(fnName,fnData){if("function"==typeof fnData.fn){var match=fnData.fn(_self);retVal=retVal&&match;var validationState=match?"success":"error";_self.setValidationState(validationState,fnData.error)}});break;case"equalTo":var parentForm=_self.getParentFormRef(),fieldToCompare=parentForm.getFieldRef(options.fieldName),match=fieldToCompare.getValue()===_self.getValue();retVal=retVal&&match;var validationState=match?"success":"error";_self.setValidationState(validationState,options.error);break;case"greaterThan":var parentForm=_self.getParentFormRef(),fieldToCompare=parentForm.getFieldRef(options.fieldName),thisValue=_self.getValue({date:"yyyy-mm-dd"}).trim(),ftcValue=fieldToCompare.getValue({date:"yyyy-mm-dd"}).trim();if(""!==thisValue&&""!==ftcValue){var match=thisValue>ftcValue;retVal=retVal&&match;var validationState=match?"success":"error";_self.setValidationState(validationState,options.error)}break;case"lessThan":var parentForm=_self.getParentFormRef(),fieldToCompare=parentForm.getFieldRef(options.fieldName),thisValue=_self.getValue({date:"yyyy-mm-dd"}).trim(),ftcValue=fieldToCompare.getValue({date:"yyyy-mm-dd"}).trim();if(""!==thisValue&&""!==ftcValue){var match=ftcValue>thisValue;retVal=retVal&&match;var validationState=match?"success":"error";_self.setValidationState(validationState,options.error)}break;case"inBetween":var parentForm=_self.getParentFormRef(),minorFieldToCompare=parentForm.getFieldRef(options.minorFieldName),majorFieldToCompare=parentForm.getFieldRef(options.majorFieldName),thisValue=_self.getValue({date:"yyyy-mm-dd"}).trim(),minValue=minorFieldToCompare.getValue({date:"yyyy-mm-dd"}).trim(),maxValue=majorFieldToCompare.getValue({date:"yyyy-mm-dd"}).trim();if(""!==thisValue&&""!==minValue&&""!==maxValue){var match=thisValue>=minValue&&maxValue>=thisValue;retVal=retVal&&match;var validationState=match?"success":"error";_self.setValidationState(validationState,options.error)}break;case"regexp":var re=options.value,match=re.test(fieldValue);retVal=retVal&&match;var validationState=match?"success":"error";_self.setValidationState(validationState,options.error);break;case"verimail":var verimail=new Comfirm.AlphaMail.Verimail;verimail.verify(fieldValue,function(status,message,suggestion){if(0>status){retVal=!1;var validationState="error";suggestion?_self.setValidationState(validationState,options.suggestion,suggestion+"?"):_self.setValidationState(validationState,options.error)}else{retVal=!0;var validationState="success";suggestion?(validationState="warning",
_self.setValidationState(validationState,options.suggestion,suggestion+"?")):_self.setValidationState(validationState,options.error)}})}}),_self.showValidationState(),retVal},resetValidationState:function(){_self.structure.formGroupRef.removeClass("has-success"),_self.structure.formGroupRef.removeClass("has-warning"),_self.structure.formGroupRef.removeClass("has-error"),_self.validation.current.state="",_self.validation.current.stateMessage="",null!==_self.structure.helpBlockRef&&_self.structure.helpBlockRef.html("")},setValidationState:function(state,i18nError,suggestion){if("undefined"==typeof suggestion&&(suggestion=""),"undefined"==typeof i18nError&&(i18nError={it:"Errore",en:"Error"}),_self.validation.current.state=state,null!==_self.structure.helpBlockRef)switch(state){case"success":break;case"warning":var error=_self._getLangStringFromI18nItem(i18nError);error+suggestion!==""&&(_self.validation.current.stateMessage+=error+suggestion+"<br>\n");break;case"error":var error=_self._getLangStringFromI18nItem(i18nError);error+suggestion!==""&&(_self.validation.current.stateMessage+=error+suggestion+"<br>\n")}},showValidationState:function(){null!==_self.structure.helpBlockRef&&(""!==_self.validation.current.stateMessage?(_self.structure.formGroupRef.addClass("has-error"),_self.structure.helpBlockRef.html(_self.validation.current.stateMessage)):(_self.structure.formGroupRef.addClass("has-success"),_self.structure.helpBlockRef.html("")))},isValidDate:function(date){var result=Date.parse(date);return isNaN(result)===!1},formatDate:function(currentDate,format){if(!_self.isValidDate(currentDate))return!1;var retDate="";switch("undefined"==typeof format&&(format="iso-8601"),format){case"iso-8601":retDate=1900+currentDate.getYear()+"-"+("0"+(currentDate.getMonth()+1)).slice(-2)+"-"+("0"+currentDate.getDate()).slice(-2);break;case"dd/mm/yyyy":retDate=("0"+currentDate.getDate()).slice(-2)+"/"+("0"+(currentDate.getMonth()+1)).slice(-2)+"/"+(1900+currentDate.getYear());break;default:retDate=1900+currentDate.getYear()+"-"+("0"+(currentDate.getMonth()+1)).slice(-2)+"-"+("0"+currentDate.getDate()).slice(-2)}return retDate},focus:function(){$(_self.structure.inputFieldRef).focus()},isToSave:function(){return _self.config.db.isToSave},getTypeaheadFieldName:function(){var typeaheadFieldName="";return typeaheadFieldName=_self.config.typeahead.hasOwnProperty("fieldName")?_self.config.typeahead.fieldName:_self.config.id},getRequestParams:function(query){var loadFilter={};$.each(_self.config.fieldsConnections.parentFields,function(fieldName,fieldData){var fieldValue="",queryFieldName=fieldName;queryFieldName=fieldData.hasOwnProperty("typeahead")&&fieldData.typeahead.hasOwnProperty("fieldName")?fieldData.typeahead.fieldName:fieldName,(field=_self.structure.nk.parentFormRef.getFieldRef(fieldName))&&(fieldValue=field.getValue()),loadFilter[queryFieldName]=fieldValue});var typeaheadFieldName=_self.getTypeaheadFieldName();loadFilter[typeaheadFieldName]=query;var requestParams={co:_self.config.helperData.codOp,ry:store.get("xcamp-ref-year"),id_sessione:store.get("xcamp-login_token"),pagination:{side:"client"},filter:loadFilter,options:{list_type:"redux"},query_data:query};return requestParams},loadGbSelectList:function(loadCallFn,callBackFn){if("build"===loadCallFn&&_self.config.helperData.ajax.loadOnBuild===!0||"focus"===loadCallFn&&_self.config.helperData.ajax.loadOnFocus===!0||"external"===loadCallFn){_self.status.select.fullLoaded=!1;var input=_self.structure.inputFieldRef;"focus"!==loadCallFn&&$(input).attr("disabled","disabled"),$.ajax({url:"/json.php",dataType:"json",data:_self.getRequestParams()}).done(function(data){var currentValue=_self.config.emptyValue;try{currentValue=$(_self.structure.inputFieldRef).attr("data-init-value")}catch(e){console.log("data-init-value non settato")}"undefined"==typeof currentValue&&(currentValue=_self.config.emptyValue);var foundCurrentValue=!1;$(input).empty();var option=$("<option>").appendTo(input);$(option).attr("value",_self.config.emptyValue),$(option).html(_self._getLangStringFromI18nItem(_self.config.i18n.emptyValue)),data.results&&data.results.dataList&&data.results.dataList.dataList&&data.results.dataList.dataList.list?($.each(data.results.dataList.dataList.list,function(i,data){var item={id:data[_self.config.helperData.listData.keyField.name],text:data[_self.config.helperData.listData.textField.name]},option=$("<option>").appendTo(input);$(option).attr("value",item.id),$(option).html(item.text),item.id.toString()===currentValue.toString()&&(foundCurrentValue=!0)}),_self.status.select.fullLoaded=!0,foundCurrentValue===!0&&_self.setValue(currentValue,!0)):(console.log(data),_self.status.select.fullLoaded=!0),$(input).removeAttr("disabled")})}},alignInitValue:function(){$(_self.structure.inputFieldRef).attr("data-init-value",_self.getValue({date:"dd/mm/yyyy"}))},hasBeenTouched:function(){var currentValue=_self.getValue({date:"dd/mm/yyyy"}),initValue=$(_self.structure.inputFieldRef).attr("data-init-value");return String(currentValue)!==String(initValue)&&console.log(_self.config.id,currentValue,"---",initValue),String(currentValue)!==String(initValue)},getOtherFormFieldRef:function(fieldId){var parentForm=_self.getParentFormRef(),fieldRef=parentForm.getFieldRef(fieldId);return fieldRef}});return _self.setConfigOptions(options),_self};