var GB_GlobalRegister=function(){var _vars={globalRegister:{}},_super=new GB_Root,_self=$.extend(!0,_super,{_init:function(){},generateUUID:function(){var d=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(d+=performance.now());var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:3&r|8).toString(16)});return uuid},getNewUUID:function(){return _self.generateUUID()},registerNewItem:function(item){for(var newUUID=_self.getNewUUID();_vars.globalRegister.hasOwnProperty(newUUID);)newUUID=_self.getNewUUID();return _vars.globalRegister[newUUID]=item,newUUID},getItemByUUID:function(UUID){return _vars.globalRegister.hasOwnProperty(UUID)?_vars.globalRegister[UUID]:!1},existsItemByUUID:function(UUID){return!!_vars.globalRegister.hasOwnProperty(UUID)}});return _self._init(),_self}(),GB_I18n=function(){var _super=new GB_Root,_self=$.extend(!0,_super,{defaultLang:"en",userLang:"",userLangStoreKey:"app-user-lang",errMessages:{},labelsMessages:{},labelsMap:{},connectedObjFns:[],translate:function(){_self._replaceLabels(),_self._objsTranslates()},setErrMessages:function(newData){_self.errMessages=newData},setLabelsMessages:function(newData){_self.labelsMessages=newData},setLabelsMap:function(newData){_self.labelsMap=newData},connectObject:function(objFn){_self.connectedObjFns.push(objFn)},getUserDefLang:function(){var userLang=_self.defaultLang;return"undefined"!=typeof store.get(_self.userLangStoreKey)?userLang=store.get(_self.userLangStoreKey):(userLang=navigator.language||navigator.userLanguage||"en",userLang=userLang.substr(0,2)),userLang},getLangMessages:function(messagesObj){return"undefined"==typeof messagesObj&&(messagesObj=_self.errMessages),messagesObj.hasOwnProperty(_self.userLang)?messagesObj[_self.userLang]:messagesObj.hasOwnProperty(_self.defaultLang)?messagesObj[_self.defaultLang]:{}},getLangMessage:function(field,subMsg){return"undefined"!=typeof field&&"undefined"!=typeof subMsg&&_self.getLangMessages().hasOwnProperty($(field).attr("id"))?_self.getLangMessages()[$(field).attr("id")][subMsg]:""},getLangLabel:function(field,subMsg){return"undefined"!=typeof field&&"undefined"!=typeof subMsg&&_self.getLangMessages(_self.labelsMessages).hasOwnProperty($(field).attr("id"))?_self.getLangMessages(_self.labelsMessages)[$(field).attr("id")][subMsg]:""},getLangError:function(field,subMsg){return"undefined"!=typeof field&&"undefined"!=typeof subMsg&&_self.getLangMessages(_self.errMessages).hasOwnProperty($(field).attr("id"))?_self.getLangMessages(_self.errMessages)[$(field).attr("id")][subMsg]:""},_objsTranslates:function(){$.each(_self.connectedObjFns,function(k,fn){fn()})},_replaceLabels:function(){var msgs=(_self.getUserDefLang(),_self.getLangMessages(_self.labelsMessages));$.each(_self.labelsMap,function(k,v){if(msgs.hasOwnProperty(k)){var m=msgs[k];"html"===v.attr?$("#"+k).html(m):$("#"+k).attr(v.attr,m)}})},replaceLabels:function(){_self._replaceLabels()},changeLang:function(lang){_self._checkMessagesStructures(),store.set(_self.userLangStoreKey,lang),_self.userLang=lang,_self.translate()},_init:function(){_self.userLang=_self.getUserDefLang()},_checkMessagesStructures:function(){var messagesCounter={},languagesCounter=0;$.each(_self.labelsMessages,function(lang,messages){languagesCounter++,$.each(messages,function(key,value){messagesCounter.hasOwnProperty(key)||(messagesCounter[key]=0),messagesCounter[key]++})}),$.each(messagesCounter,function(key,langCounter){langCounter!==languagesCounter&&console.log("Il messaggio "+key+" non e' stato tradotto in tutte le lingue!")})}});return _self._init(),_self},GB_DataCache=function(maxSize){var _super=new GB_Root,_cache=new Cache(maxSize),_self=$.extend(!0,_super,{config:{maxItems:10},cache:_cache,setItem:function(key,value){_self.cache.setItem(key,value,{expirationAbsolute:null,expirationSliding:20,priority:CachePriority.High,callback:function(k,v){console.log("removed "+k)}})},getItem:function(key){return _self.cache.getItem(key)},clear:function(){_self.cache.clear()},hasItem:function(key){return null!==_self.cache.getItem(key)}});return _self},GB_Device=function(){var _super=new GB_Root,_self=$.extend(!0,_super,{isStageVersion:!0,forceUpdateMenu:!1,forceUpdateThemes:!1,_deviceIsOnLine:!1,_screenDensityDPI:1,_screenDensityClass:"",_screenDiagonalSize:1,_fullScreenInchesSize:{width:0,height:0,diagonal:0},_onReadyDeviceFunctions:[],_onDeviceGotoOnlineFn:[],_onDeviceGotoOfflineFn:[],isPhonegapEnabled:function(){return"undefined"!=typeof device},isModernizrLoaded:function(){return"undefined"!=typeof Modernizr},getDeviceTechnology:function(){return this.isPhonegapEnabled()?device.platform:navigator.platform},getDeviceOsVersion:function(){return this.isPhonegapEnabled()?device.version:navigator.appVersion},getDeviceModel:function(){return this.isPhonegapEnabled()?device.model:navigator.appCodeName+" "+navigator.appName},getLocalStorage:function(){return this.hasLocalStorage()?this.isPhonegapEnabled()?window.localStorage:localStorage:!1},hasLocalStorage:function(){return this.isPhonegapEnabled()?!0:Modernizr.localstorage},isRotateEnabled:function(){return this.isStageVersion,!0},getPageHeaderHeight:function(){return $("#pageHeader").height()},getCurrentScreenPxAvailableHeight:function(){var footerBarHeight=$("#footerBar").height()||0;return $(window).height()-$("#pageHeader").height()-footerBarHeight},getCurrentScreenPxAvailableWidth:function(){return $(window).width()},getCurrentFullScreenHeight:function(){return $(window).height()},getCurrentFullScreenWidth:function(){return $(window).width()},getCurrentFullScreenRatio:function(){return this.getCurrentFullScreenWidth()/this.getCurrentFullScreenHeight()},isHybridVersion:function(){var retFlag=!1;switch(this.getDeviceTechnology()){case"ANDROID":case"IPHONE":case"IPAD":case"IPOD":retFlag=!0;break;default:retFlag=!1}return retFlag},isOnline:function(){return this.isPhonegapEnabled()?navigator.connection.type!==Connection.NONE:this.hasInternet()},hasInternet:function(){var s=$.ajax({type:"HEAD",timeout:2e3,url:window.location.href.split("?")[0]+"?"+Math.random(),async:!1}).status;return s>=200&&300>s||304===s},subscribeGotoOnlineFn:function(fn){_self._onDeviceGotoOnlineFn.push(fn)},subscribeGotoOfflineFn:function(fn){_self._onDeviceGotoOfflineFn.push(fn)},toggleCon:function(e){if(GB_Debug.console.log("Called "+e.type,2),"offline"==e.type)this._deviceIsOnLine=!1,$.each(_self._onDeviceGotoOnlineFn,function(onlineFn){onlineFn()});else{this._deviceIsOnLine=!0;try{$.each(_self._onDeviceGotoOfflineFn,function(offlineFn){offlineFn()})}catch(ex){alert("Woot, you are back online.")}}},getCurrentFullScreenPixelsSize:function(){if(0===this._fullScreenInchesSize.width){var a=this._fullScreenInchesSize.width=this.getCurrentFullScreenWidth(),b=this._fullScreenInchesSize.height=this.getCurrentFullScreenHeight();this._fullScreenInchesSize.diagonal=Math.sqrt(a*a+b*b)}return this._fullScreenInchesSize.width},getScreenDensityInPx:function(){if(1===this._screenDensityDPI)if(window.matchMedia("(min-resolution: 1dpi)").matches){for(i=500;i>1;i--)if(window.matchMedia("(min-resolution: "+i+"dpi)").matches){this._screenDensityDPI=i;break}}else window.matchMedia("(min-device-width: 1536px) and (max-device-width: 2048px)")?dpi="ipad-retina":window.matchMedia("(min-device-width: 768px) and (max-device-width: 1024px)")?dpi="ipad":window.matchMedia("(max-device-width: 480px)")?dpi="iphone":dpi="0";return this._screenDensityDPI},getScreenDensityClass:function(){return""===this._screenDensityClass&&(this.getScreenDensityInPx()<140?this._screenDensityClass="ldpi":this.getScreenDensityInPx()<200?this._screenDensityClass="mdpi":this.getScreenDensityInPx()<280?this._screenDensityClass="hdpi":this._screenDensityClass="xhdpi"),this._screenDensityClass},getScreenResolutionClass:function(){retVal="";var parser=new UAParser,os=(parser.getBrowser(),parser.getEngine(),parser.getOS()),device=parser.getDevice(),deviceData={vendor:"undefined"!=typeof device.vendor?device.vendor.toLowerCase():"-",model:"undefined"!=typeof device.model?device.model.toLowerCase():"-",type:"undefined"!=typeof device.type?device.type.toLowerCase():"-"},osFlags={mobile:!1,android:!1,linux:!1,windows:!1,mac:!1,ipad:!1,iphone:!1};return os.name.toLowerCase().match(/^ios|android|blackberry|windows\sphone$/)&&(osFlags.mobile=!0),os.name.toLowerCase().match(/^windows$/)&&(osFlags.windows=!0),os.name.toLowerCase().match(/^linux|ubuntu|android$/)&&(osFlags.linux=!0),os.name.toLowerCase().match(/^mac\b|mac\s.*$/)&&(osFlags.mac=!0),deviceData.model.match(/^ipad$/)&&(osFlags.ipad=!0),deviceData.model.match(/^iphone$/)&&(osFlags.iphone=!0),"-"===deviceData.type?osFlags.mobile||osFlags.ipad||osFlags.iphone?_self.getCurrentFullScreenPixelsSize()<800||osFlags.iphone?retVal="smartphone":retVal="tablet":retVal="wide":"mobile"===deviceData.type?retVal="smartphone":"tablet"===deviceData.type?retVal="tablet":retVal="wide",retVal},getCurrentLanguage:function(){var lang=null;if("undefined"!=typeof GbStorage&&GbStorage){var clientConfig=GbStorage.loadClientAppConfig();lang=clientConfig.selectedLanguageIsoCode||_self.getCurrentBrowserLanguage()}else lang=_self.getCurrentBrowserLanguage();return lang},getCurrentBrowserLanguage:function(length){"undefined"==typeof length&&(length=2);var lang="zz";try{lang=navigator.language||navigator.userLanguage}catch(e){}return lang.substr(0,length)},init:function(){$(window).on("online",_self.toggleCon),$(window).on("offline",_self.toggleCon),this._deviceIsOnLine=this.isOnline(),$(document).ready(function(){window.isphone=!1,-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")&&(window.isphone=!0),window.isphone?(GB_Debug.console.log("[ deviceready 1 ]",0),document.addEventListener("deviceready",function(){_self.onDeviceReady()},!1)):_self.onDeviceReady()})},onDeviceReady:function(){var self=this;$.each(self._onReadyDeviceFunctions,function(i,fn){"function"==typeof fn&&fn()})},addOnDeviceReadyFunction:function(fn){this._onReadyDeviceFunctions.push(fn)},hasPopupEnabled:function(){return popupWindow=window.open("","","toolbar=no, scrollbars=yes, resizable=yes, top=1, left=1, width=1, height=1"),popupWindow?(popupWindow.close(),!0):!1}});return _self.init(),_self}(),GB_App=function(){var _super=new GB_Root,_self=$.extend(!0,_super,{className:"GB_App"});return _self},GB_App_Config=function(){var _super=new GB_App,_self=$.extend(!0,_super,{className:"GB_App_Config",config:{},getConfig:function(configItemsNameArray,configObject){if("undefined"==typeof configObject&&(configObject=_self.config),"undefined"==typeof configItemsNameArray)return _self.config;var retVal=null,itemFound=!1;return $.each(configItemsNameArray,function(k,v){itemFound===!1&&configObject.hasOwnProperty(v)&&(itemFound=!0,retVal=k===configItemsNameArray.length-1?configObject[v]:_self.getConfig(configItemsNameArray.slice(k),configObject[v]))}),retVal}});return _self},GB_Mutex=function(){var _super=new GB_Root,_self=$.extend(!0,_super,{className:"GB_Mutex",data:{_locked:{}},lock:function(name,fn){_self.data._locked[name]=_self.data._locked[name]||0,1===++_self.data._locked[name]?(fn(),_self.data._locked[name]--):(_self.data._locked--,setTimeout(function(){_self.execFn(name,fn)},100))},lockOnce:function(name,fn){_self.data._locked[name]=_self.data._locked[name]||0,1===++_self.data._locked[name]&&(fn(),_self.data._locked[name]--)}});return _self}(),GB_Wallet=function(){var _super=new GB_Root,_self=$.extend(!0,_super,{className:"GB_Wallet",data:{},setItem:function(name,value){return"undefined"!=typeof value&&(_self.data[name]=value),_self},getItem:function(name){return _self.data.hasOwnProperty(name)?_self.data[name]:!1},hasItem:function(name){return _self.data.hasOwnProperty(name)},removeItem:function(name){return _self.data.hasOwnProperty(name)?delete _self.data[name]:!1},dump:function(){return GB_Debug.console.log("---- GB_Wallet data - START ----"),GB_Debug.console.log(_self.data),GB_Debug.console.log("---- GB_Wallet data - STOP -----"),_self},toJsonString:function(){return JSON.stringify(_self.data)},getData:function(){return JSON.parse(JSON.stringify(_self.data))}});return _self}();